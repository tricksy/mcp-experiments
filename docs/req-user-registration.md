Google Apps Script で コンテナバインドしたスプレッドシートを管理 UI の"単一ソース"とし、基本シート（初期設定／返答タイトル／返答条件／返答内容／ボタン設定）と応用シート（フラグ条件／フラグ変更／画像生成など）へレコードを ダイアログ内タブ UI から登録・編集・確認できるようにする。
画像は Dropbox 共有リンクを貼り付け運用とする。画像は可能ならプレビューを表示

register.html
1300px x 900pxで作成

なるべく１ページで登録できるようにしたい

## 種別に応じた入力フィールド表示

各種別（text、image、buttonsなど）によって必要な入力フィールドが異なるため、選択した種別に応じて関連する入力フィールドのみを表示する。表示/非表示の切り替えはJavaScriptで制御し、ユーザーの入力効率を向上させる。

### 返答内容タブ
種別による表示フィールドの例：
- `text`: 送信者名、送信者アイコン、メインテキスト、サブ1
- `image`: 送信者名、送信者アイコン、画像
- `buttons`: 送信者名、送信者アイコン、タイトル、サブ1

### ボタン設定タブ
種別による表示フィールドの例：
- `postback`: メイン1(表示テキスト)、メイン2(データ値)、サブ1
- `message`: メイン1(テキスト)のみ
- `uri`: メイン1(表示テキスト)、メイン2(URL)

## シート構成

### 基本シート

#### 初期設定シート
| 列 | 見出し | 型 | 備考 |
|----|--------|----|------|
| B | No (章) | 整数 | 章レコードの連番（チェック用） |
| C | 章 | 文字列 | 章名（主キー） |
| D | デフォルト章 | チェックボックス (TRUE/FALSE) | TRUE 行は 1 行のみ許可 |
| E | (空) | Spacer | — |
| F | No (LINE) | 整数 | LINE アカウント連番 |
| G | LINEアカウント | 文字列 | 任意 ID 文字列 |
| H | デフォルトLINE | チェックボックス (TRUE/FALSE) | TRUE 行は 1 行のみ許可 |

#### 返答タイトルシート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | 返答タイトル | 文字列（ユニーク） | 主キー |
| C | LINEアカウント | リスト: 初期設定!B:B |
| D | 次章 | 文字列／空欄可 | フロー終了時は空欄 |

#### 返答条件シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | 返答条件コード | 整数 | GAS で自動採番 (MAX+1) |
| C | 章 | 文字列 | 初期設定!A:A 参照 |
| D | 優先度 | 数値 | デフォルト 0 |
| E | 登録状況 | `未登録` / `有料登録` / `無料登録` |
| F | イベントタイプ | `message` / `postback` 他追加容易 |
| G | 関数名 | 文字列 | 任意 (外部連携呼び出し) |
| H | 引数(1) | 文字列 | 任意 |
| I | スクリプトコード | 文字列 | 自由記入（コード断片可） |
| J | Scriptパターン | 文字列 | 自由記入 |

#### 返答内容シート
*1 つの**返答タイトル**に対し **複数 (1:N) の返答内容** を紐付け可能*

| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | 返答内容コード | 文字列（ユニーク） | 主キー |
| C | 返答タイトル | 文字列 | 返答タイトル!A:A 参照 |
| D | 種別 | `text` / `buttons` / `image` / `sticker` / `location` / `imagemap` / `confirm` / `image-carousel` / `richmenu` / `flex` / `escape:pay` |
| E | 送信者名 | 文字列 | 任意 |
| F | 送信者アイコン | URL | Dropbox 共有リンク可 |
| G | 画像 | URL | 任意 (種別=image などの場合) |
| H | メイン | 文字列 | 本文またはタイトル |
| I | サブ1 | 文字列 | 任意 |
| J | サブ2 | 文字列 | 任意 |
| K | 順番 | 整数 (デフォルト1) | 同一タイトル内表示順、任意変更可 |
| L | LINEアカウント | 文字列 | 初期設定!B:B 参照 |

#### ボタン設定シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | 返答内容コード | 文字列 | 返答内容!A:A 参照 |
| C | 種別 | `postback` / `message` / `image-carousel-message` / `quickreply-message` / `uri` / `area-message` |
| D | 画像 | URL | 任意、Dropbox 共有リンク |
| E | メイン1 | 文字列 | 任意 |
| F | メイン2 | 文字列 | 任意 |
| G | サブ1 | 文字列 | 任意 |
| H | サブ2 | 文字列 | 任意 |
| I | サブ3 | 文字列 | 任意 |
| J | 順番 | 整数 (デフォルト1) | 同一返答内容内並び順 |

### 応用シート

#### (応用)フラグ条件シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | コード | 整数 | ユニーク |
| C | フラグ条件 | 文字列 | フラグ名と条件式 |
| D | 返答タイトル | 文字列 | 返答タイトル!B:B 参照 |

#### (応用)フラグ変更シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | コード | 整数 | ユニーク |
| C | 返答内容コード | 文字列 | 返答内容!B:B 参照 |
| D | フラグ名 | 文字列 | 変数シート参照 |
| E | 操作 | `set`/`add`/`del` | 設定/加算/減算 |
| F | 値 | 整数/文字列 | 設定値 |

#### (応用)画像生成シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | 画像コード | 文字列 | ユニーク |
| C | ベース画像 | URL | 背景となる画像 |
| D | 説明 | 文字列 | 説明用メモ |

#### スクリプトシート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | スクリプト名 | 文字列 | ユニーク |
| C | 内容 | 文字列 | JavaScriptコード |

#### 変数シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | 変数名 | 文字列 | ユニーク |
| C | 初期値 | 整数/文字列 | 変数初期設定値 |
| D | 説明 | 文字列 | 変数の説明 |

#### トロフィ条件シート
| 列 | 名称 | 型 | 備考 |
|----|------|----|------|
| B | トロフィID | 文字列 | ユニーク |
| C | 名前 | 文字列 | トロフィ名 |
| D | 条件 | 文字列 | 獲得条件式 |
| E | 画像URL | URL | トロフィ画像 |

## UI機能要件

1. **タブ式インターフェース**
   - 基本シート用の5つのタブ（初期設定／返答タイトル／返答条件／返答内容／ボタン設定）を用意
   - 必要に応じて応用シート用のタブも追加可能な設計
   - 各タブの切り替えでデータの表示を即時更新

2. **データ編集機能**
   - 新規追加：各シートに新しいレコードを追加する機能
   - 既存データの編集：各フィールドをインラインまたはモーダルで編集
   - データの削除：不要なレコードを削除
   - 保存機能：スプレッドシートに変更を反映

3. **画像プレビュー機能**
   - サムネイル表示：画像URLのサムネイルプレビュー
   - 拡大表示：クリックで大きなプレビューをモーダルウィンドウで表示
   - 画像アップロード：可能であればDropboxへの直接アップロード連携

4. **データ検証**
   - 必須項目の入力チェック：保存前に必須フィールドが入力されているか確認
   - 重複データのチェック：主キーの重複や一意制約の検証
   - デフォルト設定の妥当性：章やLINEアカウントのデフォルト設定が適切か
   - 参照整合性チェック：各シート間の参照関係が正しいか検証

5. **モーダルウィンドウによる詳細編集**
   - 返答内容とボタン設定：複雑なデータはモーダルウィンドウで詳細編集
   - 種別に応じた動的UI：選択した種別によって表示するフィールドを動的に変更
   - プレビュー機能：編集内容のプレビューを表示（特に画像やリッチコンテンツ）

## 実装要件

1. **シンプルさと使いやすさ**
   - 直感的なUI設計で、特別な訓練なしで使用できること
   - レスポンシブデザインで様々な画面サイズに対応

2. **拡張性**
   - 新しいシートや項目の追加に対応できる柔軟な設計
   - 将来的な機能拡張を見据えたモジュール構造

3. **パフォーマンス**
   - 大量のデータでも快適に動作するよう最適化
   - データの読み込みと保存を効率的に行う

4. **セキュリティ**
   - 入力データのサニタイズとバリデーション
   - 不正な操作や入力を防止する設計


